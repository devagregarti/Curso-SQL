ğŸ“Š EstatÃ­sticas com AnÃ¡lise no PostgreSQL
ğŸ§  O que sÃ£o estatÃ­sticas em bancos de dados?
O PostgreSQL guarda informaÃ§Ãµes internas sobre as tabelas e colunas.

Essas informaÃ§Ãµes sÃ£o chamadas de estatÃ­sticas.

Elas ajudam o banco a decidir como executar uma consulta da forma mais rÃ¡pida possÃ­vel.

ğŸ” Para que servem as estatÃ­sticas?
Ajudam o otimizador (motor do PostgreSQL) a escolher o melhor plano de execuÃ§Ã£o.

Indicam:

Quantas linhas existem em uma tabela.

Quais valores aparecem com mais frequÃªncia em uma coluna.

A distribuiÃ§Ã£o dos dados (valores Ãºnicos, repetidos etc.).

ğŸ§ª Como o PostgreSQL coleta estatÃ­sticas?
Automaticamente, quando os dados mudam bastante.

TambÃ©m Ã© possÃ­vel forÃ§ar essa coleta com o comando:

ğŸ§  Exemplo:
sql
Copy
Edit
ANALYZE;
Ou, se quiser analisar apenas uma tabela:

sql
Copy
Edit
ANALYZE nome_da_tabela;
âš™ï¸ Quando usar ANALYZE manualmente?
Depois de inserir muitos dados novos.

ApÃ³s excluir ou atualizar muitos registros.

Depois de importaÃ§Ãµes grandes.

Quando a consulta estÃ¡ lenta e vocÃª quer ajudar o otimizador a ter dados atualizados.

ğŸ“ˆ Onde as estatÃ­sticas sÃ£o usadas?
Ao executar comandos como:

sql
Copy
Edit
EXPLAIN SELECT * FROM clientes WHERE cidade = 'Dublin';
O PostgreSQL vai usar as estatÃ­sticas da coluna cidade para decidir:

Se deve usar um Ã­ndice.

Se deve fazer uma leitura total da tabela (seq scan).

Qual caminho Ã© mais eficiente.

ğŸ”§ Comando completo: VACUUM ANALYZE
Esse comando faz duas coisas:

Limpa o banco (remove restos de dados antigos).

Atualiza as estatÃ­sticas.

ğŸ§  Exemplo:
sql
Copy
Edit
VACUUM ANALYZE;
Muito usado de tempos em tempos para manter o banco saudÃ¡vel.

ğŸ“‹ Como ver estatÃ­sticas de uma tabela?
VocÃª pode ver algumas informaÃ§Ãµes com esta consulta:

sql
Copy
Edit
SELECT * FROM pg_stats WHERE tablename = 'clientes';
Isso mostra dados como:

Quantos valores distintos existem por coluna.

Quais sÃ£o os valores mais comuns.

DistribuiÃ§Ã£o dos dados.

ğŸ“Œ Exemplo prÃ¡tico
Crie uma tabela e insira muitos dados:

sql
Copy
Edit
CREATE TABLE produtos (
  id SERIAL PRIMARY KEY,
  categoria TEXT
);

-- Insere 10 mil linhas (exemplo com categorias repetidas)
INSERT INTO produtos (categoria)
SELECT CASE
  WHEN i % 2 = 0 THEN 'EletrÃ´nicos'
  ELSE 'Roupas'
END
FROM generate_series(1, 10000) i;
Rode ANALYZE para atualizar as estatÃ­sticas:

sql
Copy
Edit
ANALYZE produtos;
Veja como o banco usa isso com EXPLAIN:

sql
Copy
Edit
EXPLAIN SELECT * FROM produtos WHERE categoria = 'EletrÃ´nicos';
âœ… Resumo
O PostgreSQL usa estatÃ­sticas internas para escolher o plano mais rÃ¡pido para cada consulta.

VocÃª pode atualizar essas estatÃ­sticas com o comando ANALYZE.

EstatÃ­sticas atualizadas sÃ£o essenciais para performance.

Use tambÃ©m VACUUM ANALYZE para manter o banco limpo e otimizado.

Consultas lentas podem melhorar muito sÃ³ com ANALYZE.

