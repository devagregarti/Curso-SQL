Aula: Consultando Dados em Tabelas Particionadas no PostgreSQL
âœ… Relembrando: o que Ã© uma tabela particionada?
Ã‰ uma tabela que foi dividida em partes menores chamadas de partiÃ§Ãµes.

O usuÃ¡rio consulta como se fosse uma Ãºnica tabela.

O PostgreSQL decide em qual partiÃ§Ã£o procurar os dados.

ğŸ” Consultar dados Ã© igual ao que jÃ¡ vimos
VocÃª consulta a tabela principal normalmente, usando comandos SELECT.

Exemplo:

sql
Copy
Edit
SELECT * FROM pedidos;
Mesmo que os dados estejam divididos em pedidos_2023, pedidos_2024, etc., vocÃª nÃ£o precisa se preocupar:
ğŸ‘‰ O PostgreSQL traz os resultados de todas as partiÃ§Ãµes automaticamente.

ğŸ¯ Consultas com filtros (WHERE)
Usar filtros ajuda o PostgreSQL a procurar somente nas partiÃ§Ãµes necessÃ¡rias, o que pode deixar a busca mais rÃ¡pida.

Exemplo:

sql
Copy
Edit
SELECT * FROM pedidos
WHERE data_pedido BETWEEN '2023-01-01' AND '2023-12-31';
O PostgreSQL verifica a regra de particionamento (por data) e acessa apenas a partiÃ§Ã£o de 2023.

Isso se chama "Pruning de PartiÃ§Ãµes" (partition pruning).

ğŸ“¦ Consultar diretamente uma partiÃ§Ã£o (opcional)
VocÃª tambÃ©m pode consultar uma partiÃ§Ã£o especÃ­fica, se quiser:

sql
Copy
Edit
SELECT * FROM pedidos_2023;
Isso Ã© Ãºtil se vocÃª sabe exatamente em qual partiÃ§Ã£o o dado estÃ¡.

Mas em geral, nÃ£o Ã© necessÃ¡rio â€” o PostgreSQL cuida disso para vocÃª.

ğŸ§  Exemplos simples com WHERE
sql
Copy
Edit
-- Buscar todos os pedidos do cliente JoÃ£o
SELECT * FROM pedidos
WHERE cliente = 'JoÃ£o';

-- Buscar pedidos feitos em fevereiro de 2024
SELECT * FROM pedidos
WHERE data_pedido BETWEEN '2024-02-01' AND '2024-02-29';
Em ambos os casos, o PostgreSQL analisa o filtro e usa sÃ³ as partiÃ§Ãµes relevantes.

ğŸ§ª Exemplo prÃ¡tico completo
Vamos imaginar que temos essas partiÃ§Ãµes:

pedidos_2023 para pedidos de 2023

pedidos_2024 para pedidos de 2024

E os seguintes dados:

sql
Copy
Edit
INSERT INTO pedidos (data_pedido, cliente) VALUES
('2023-05-10', 'Lucas'),
('2024-03-20', 'Fernanda');
Agora, se rodarmos:

sql
Copy
Edit
SELECT * FROM pedidos WHERE cliente = 'Fernanda';
O PostgreSQL vai direto na partiÃ§Ã£o de 2024 â€” sem precisar ler os dados de 2023.

ğŸ“ˆ Usando funÃ§Ãµes de agregaÃ§Ã£o com partiÃ§Ãµes
VocÃª pode usar COUNT, AVG, SUM, etc., da mesma forma que em tabelas normais:

sql
Copy
Edit
-- Contar quantos pedidos foram feitos em 2024
SELECT COUNT(*) FROM pedidos
WHERE data_pedido BETWEEN '2024-01-01' AND '2024-12-31';
ğŸ§¼ Boas prÃ¡ticas
Sempre use WHERE com colunas que fazem parte do particionamento (ex: data), para acelerar a consulta.

Use Ã­ndices nas partiÃ§Ãµes se precisar melhorar ainda mais a performance.

Evite consultar partiÃ§Ãµes diretamente se nÃ£o for necessÃ¡rio â€” mantenha tudo centralizado pela tabela principal.

ğŸ”š ConclusÃ£o
Consultar dados em tabelas particionadas Ã© igual a consultar uma tabela normal.

O PostgreSQL cuida de acessar sÃ³ as partiÃ§Ãµes certas â€” desde que os filtros sejam bem usados.

Usar bem o WHERE ajuda a deixar as buscas mais rÃ¡pidas e eficientes.

