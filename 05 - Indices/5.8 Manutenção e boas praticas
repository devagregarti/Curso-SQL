.ğŸ”§ 1. Como monitorar a efetividade dos Ã­ndices
ğŸ§ª Use pg_stat_user_indexes e pg_stat_user_tables
Essas views internas mostram quantas vezes um Ã­ndice foi usado.

ğŸ“Œ Ver Ã­ndice pouco usado:


SELECT
  relname AS tabela,
  indexrelname AS indice,
  idx_scan AS vezes_usado
FROM
  pg_stat_user_indexes
JOIN
  pg_index ON pg_index.indexrelid = pg_stat_user_indexes.indexrelid
WHERE
  idx_scan = 0
ORDER BY
  relname;
Se idx_scan = 0, o Ã­ndice nunca foi usado desde o Ãºltimo reset das estatÃ­sticas.

ğŸ”„ Ver estatÃ­sticas de leitura geral de Ã­ndices

SELECT
  relname,
  idx_scan,
  idx_tup_read,
  idx_tup_fetch
FROM
  pg_stat_user_tables
ORDER BY idx_scan DESC;
idx_scan: quantas vezes os Ã­ndices foram usados para buscar dados

idx_tup_read: quantas tuplas foram lidas usando Ã­ndices

idx_tup_fetch: quantas tuplas foram realmente retornadas apÃ³s a busca

ğŸ“‰ Use pg_stat_statements para analisar queries reais
sql
Copy
Edit
-- Ativar a extensÃ£o (se ainda nÃ£o estiver ativa)
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

-- Ver as consultas mais executadas
SELECT
  query,
  calls,
  total_exec_time,
  rows
FROM
  pg_stat_statements
ORDER BY total_exec_time DESC
LIMIT 10;
Isso ajuda a cruzar quais consultas mais pesadas podem se beneficiar de um Ã­ndice â€” ou se estÃ£o ignorando os existentes.

ğŸ—‘ Detectar Ã­ndices duplicados ou redundantes
sql
Copy
Edit
SELECT
  indrelid::regclass AS tabela,
  indexrelid::regclass AS indice,
  pg_size_pretty(pg_relation_size(indexrelid)) AS tamanho
FROM
  pg_index
WHERE
  indisunique = false
ORDER BY pg_relation_size(indexrelid) DESC;
Se vocÃª tem muitos Ã­ndices com colunas parecidas (ex: email, email, nome, nome, email), pode haver redundÃ¢ncia.

âœ… 2. Boas prÃ¡ticas de manutenÃ§Ã£o de Ã­ndices
ğŸ§¼ 1. Remova Ã­ndices que nÃ£o estÃ£o sendo usados
Se idx_scan = 0 por muito tempo â†’ candidato Ã  exclusÃ£o

Mas cuidado: sempre teste em ambiente de homologaÃ§Ã£o antes!

ğŸ” 2. Reindexe Ã­ndices corrompidos ou inchados
Com o tempo, Ã­ndices podem ficar fragmentados.

Use REINDEX para reconstruÃ­-los:


REINDEX INDEX idx_nome;
-- Ou para todos os Ã­ndices de uma tabela:
REINDEX TABLE clientes;
ğŸ“ 3. Evite criar Ã­ndice automaticamente para tudo
NÃ£o indexe colunas com:

Poucos valores distintos

Alta taxa de atualizaÃ§Ã£o

Uso raro em filtros/junÃ§Ãµes

ğŸ“Š 4. Atualize estatÃ­sticas com frequÃªncia
O otimizador depende de estatÃ­sticas atualizadas.

Execute:


ANALYZE;
-- Ou em tabela especÃ­fica:
ANALYZE clientes;
ğŸ“† 5. Agende uma revisÃ£o periÃ³dica dos Ã­ndices
A cada 3 a 6 meses, revise:

Quais Ã­ndices existem

Quais estÃ£o sendo usados

Quais poderiam ser otimizados ou removidos

ğŸ§  6. Documente os Ã­ndices e o motivo de existÃªncia
Em projetos grandes, documente:

Quem criou o Ã­ndice

Por que foi criado

Qual consulta ele estÃ¡ otimizando

Quando foi a Ãºltima revisÃ£o

