üßØ Tratamento de Erros (TRY e CATCH) no PL/pgSQL
‚ùì O que √© o TRY / CATCH?
TRY e CATCH s√£o estruturas usadas para tratar erros que podem acontecer no meio do c√≥digo.

No PostgreSQL (PL/pgSQL), o nome correto da estrutura √©:
BEGIN ... EXCEPTION ... END
(funciona como um TRY/CATCH).

üí° Por que usar?
Para evitar que o c√≥digo quebre quando algo d√° errado.

Permite mostrar uma mensagem amig√°vel ou tomar uma a√ß√£o alternativa.

Muito √∫til ao lidar com dados que podem estar errados ou opera√ß√µes que podem falhar.

üß± Estrutura b√°sica do tratamento de erro
sql
Copy
Edit
BEGIN
  -- C√≥digo que pode causar erro
EXCEPTION
  WHEN tipo_do_erro THEN
    -- O que fazer se o erro acontecer
END;
üß™ Exemplo simples
sql
Copy
Edit
DO $$
BEGIN
  -- Vamos dividir por zero (erro!)
  RAISE NOTICE 'Resultado: %', 10 / 0;
EXCEPTION
  WHEN division_by_zero THEN
    RAISE NOTICE 'Erro: tentativa de dividir por zero!';
END;
$$;
O c√≥digo tenta dividir 10 por 0 ‚Üí isso causa erro.

Mas o erro √© tratado, e o c√≥digo mostra uma mensagem controlada.

üìã Erros comuns que podem ser tratados
Tipo do erro	Quando acontece
division_by_zero	Divis√£o por zero
unique_violation	Inser√ß√£o duplicada em coluna √∫nica
foreign_key_violation	Viola√ß√£o de chave estrangeira
undefined_column	Coluna n√£o existe
others	Qualquer outro erro n√£o tratado acima

üîÑ Exemplo com m√∫ltiplos erros
sql
Copy
Edit
DO $$
BEGIN
  INSERT INTO clientes(id, nome) VALUES (1, 'Ana');
  -- Tenta inserir o mesmo ID novamente
  INSERT INTO clientes(id, nome) VALUES (1, 'Jo√£o');
EXCEPTION
  WHEN unique_violation THEN
    RAISE NOTICE 'Erro: ID duplicado!';
  WHEN others THEN
    RAISE NOTICE 'Outro erro aconteceu!';
END;
$$;
üß† Dica: sempre que poss√≠vel, trate erros previs√≠veis
Erros comuns devem ser tratados com nomes espec√≠ficos (ex: division_by_zero).

Use WHEN others THEN como √∫ltimo caso, para pegar erros inesperados.

‚ö†Ô∏è Boas pr√°ticas no tratamento de erros
‚úÖ Use mensagens claras no RAISE NOTICE, para facilitar o entendimento.

‚úÖ N√£o esconda erros s√©rios ‚Äì registre ou trate de forma adequada.

‚ùå Evite deixar o bloco EXCEPTION vazio (sem a√ß√£o nenhuma).

‚úÖ Mantenha o c√≥digo indentado e organizado para facilitar a leitura.

‚úÖ Resumo da aula
O bloco BEGIN ... EXCEPTION ... END √© o equivalente ao TRY / CATCH.

Ele permite capturar e tratar erros de forma controlada.

Use isso para evitar que o c√≥digo pare de funcionar com erros simples.

Sempre trate os erros de forma clara e objetiva.

