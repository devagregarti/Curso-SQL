üéØ T√≥pico: RETURN QUERY em PL/SQL
1. O que √© o RETURN QUERY?
Em PL/SQL, o RETURN QUERY √© usado em fun√ß√µes que retornam um conjunto de linhas (rows), ou seja, fun√ß√µes que retornam uma tabela (table) ou um cursor.

Permite que a fun√ß√£o execute uma consulta SQL e retorne o resultado para quem chamou a fun√ß√£o.

2. Quando usar?
Quando voc√™ quer encapsular uma consulta complexa dentro de uma fun√ß√£o.

Para reutilizar l√≥gica SQL e retornar m√∫ltiplas linhas de dados.

3. Tipos comuns de retorno para RETURN QUERY
REF CURSOR (cursor din√¢mico) ‚Äî muito usado para retornar resultados flex√≠veis.

Cole√ß√µes (table types) ‚Äî arrays ou tabelas definidas em PL/SQL.

4. Exemplo pr√°tico usando REF CURSOR
Fun√ß√£o que retorna um cursor com produtos com pre√ßo acima de um valor

plsql
Copy
Edit
CREATE OR REPLACE FUNCTION produtos_caros(
  p_preco_min NUMBER
) RETURN SYS_REFCURSOR IS
  v_cursor SYS_REFCURSOR;
BEGIN
  OPEN v_cursor FOR
    SELECT produto_id, nome, preco
    FROM produtos
    WHERE preco > p_preco_min;
    
  RETURN v_cursor;
END;
Aqui, o RETURN v_cursor; retorna o conjunto de linhas da consulta.

5. Como usar na pr√°tica (exemplo b√°sico)
plsql
Copy
Edit
DECLARE
  c SYS_REFCURSOR;
  v_produto_id produtos.produto_id%TYPE;
  v_nome produtos.nome%TYPE;
  v_preco produtos.preco%TYPE;
BEGIN
  c := produtos_caros(100);
  
  LOOP
    FETCH c INTO v_produto_id, v_nome, v_preco;
    EXIT WHEN c%NOTFOUND;
    DBMS_OUTPUT.PUT_LINE(v_produto_id || ' - ' || v_nome || ' - ' || v_preco);
  END LOOP;
  
  CLOSE c;
END;
6. Dicas r√°pidas
Use REF CURSOR para retornar tabelas de forma flex√≠vel.

N√£o esque√ßa de abrir o cursor antes do RETURN.

O cliente que chama a fun√ß√£o √© respons√°vel por percorrer o resultado.

Resumo para v√≠deo
Explique que fun√ß√µes podem retornar resultados complexos (listas de linhas) com RETURN QUERY.

Mostre o exemplo simples com REF CURSOR para filtrar dados.

Demonstre rapidamente como consumir o resultado no bloco PL/SQL.